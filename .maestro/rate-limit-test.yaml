appId: com.glideapp
---
# Rate Limiting Test for Login
# This test verifies that client-side rate limiting works correctly

- launchApp

# Wait for auth screen to load
- assertVisible: "Glide"
- assertVisible: "Voice notes, powered by AI"

# Test 1: Attempt 5 failed logins with wrong password
- repeat:
    times: 5
    commands:
      # Enter test email
      - tapOn: "Email"
      - inputText:
          id: "Email"
          text: "ratelimit@test.com"

      # Enter wrong password
      - tapOn: "Password"
      - inputText:
          id: "Password"
          text: "wrongpassword"

      # Submit login
      - tapOn: "Sign In"

      # Wait for error message
      - waitForAnimationToEnd

      # Verify we see remaining attempts warning after 3rd failure
      - assertVisible:
          text: "attempts remaining"
          optional: true

# Test 2: Verify 6th attempt shows lockout message
- tapOn: "Email"
- inputText:
    id: "Email"
    text: "ratelimit@test.com"

- tapOn: "Password"
- inputText:
    id: "Password"
    text: "wrongpassword"

- tapOn: "Sign In"
- waitForAnimationToEnd

# Verify lockout message appears
- assertVisible: "Account Temporarily Locked"
- assertVisible: "Too many failed login attempts"
- assertVisible: "Time remaining:"

# Verify submit button is disabled
- assertVisible:
    text: "Sign In"
    optional: true

# Take screenshot of lockout state
- takeScreenshot: "rate-limit-lockout"

# Test 3: Clear AsyncStorage and verify login works again
# (In real scenario, user would wait 5 minutes or clear app data)
# For testing, we'll verify the UI state is correct

- stopApp
